# sBox

Run programs in a sandbox environment without writting to rootfs.


## Description:

This program is NOT a full-fledge container like docker!

Instead, it is a cut-down version of container, namely a sandbox, designed 
to allow you to run programs without worrying about polluting your rootfs.

You may chose to merge the files generated by your program into rootfs 
once it exits.


## Usage: 

Run program in sandbox

```bash
sbox [-n|--container-name NAME] [-r|--user-root USER] [-h|--help] PROGRAM
```

* **-n | --container-name NAME**
    
    Name of the container, will create rootfs under `/tmp/NAME` via **overlayfs**

* **-r | --user-root USER** 
    
    Still need root to mount.\
    Enable user namespace.\
    Drop root privileges to user `USER` before enter *user namespace* so that sandbox will be bound by `USER`'s privilege.\
    Finally map `USER` to root inside sandbox.

* **-d | --snapshot-dir DIR** 

    Path of the snapshot directory storing commited files after program exit from sandbox.\
    TODO: ...
    
* **-h | --help**

    Display usage information.

## Note/Caveat:

- sBox use `OverlayFS` as the "storage engine" (docker jargon ><). You may find files generated by programs running inside sandbox under `/tmp/CONTAINER_NAME`.

- Can not map current user to arbitary user in sandbox. Mapping is no longer do-able using pure shell script because newer kernel doesn't allow updating uid_map/gid_map after 'execve'[(\*)](https://stackoverflow.com/questions/45972426/unshare-user-namespace-and-set-uid-mapping-with-newuidmap).

- If `-r USER` is not set, sBox will not create custom *user namespace*, so all other namespaces will be children of the namespace the invoking process is in(e.g., shell's user namespace). Do not set this flag if custom *user namespace* breaks your program. On the other hand, if this flag is set, all other namespaces will be children to the newly created *user namespace*.
